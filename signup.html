<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sign Up | ClothsSales</title>
  <link rel="stylesheet" href="css/style.css">
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar">
    <div class="nav-left">
      <a href="index.html" class="logo-link"><span class="logo-dot">‚óè</span><span class="logo-text">ClothsSales</span></a>
    </div>

    <button id="menu-toggle" class="menu-toggle" aria-expanded="false" aria-controls="top-navigation" aria-label="Toggle navigation">
      <span class="menu-icon" aria-hidden="true"></span>
    </button>

    <ul id="top-navigation" class="nav-center">
      <li><a href="index.html">Home</a></li>
      <li><a href="schools.html">School</a></li>
      <li><a href="billing.html">Billing</a></li>
      <li><a href="students.html">Students / Parents</a></li>
    </ul>

    <div class="nav-right">
      <a href="#" class="signin" id="open-signin">Sign In</a>
      <a href="#" class="btn" id="open-signup">Sign Up</a>
      <span class="navbar-user" id="navbar-user" style="display:none;"></span>
    </div>
  </nav>

  <div class="auth-page">
    <div class="auth-box">
      <h2>Create Account</h2>
      <p class="features-subtitle">Enter your details or sign up quickly with Google.</p>

      <form id="signupForm" class="auth-form">
        <div class="form-group">
          <label>Full Name</label>
          <input type="text" id="signupName" class="form-input" required placeholder="Your name">
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" id="signupEmail" class="form-input" required placeholder="you@school.com">
        </div>
        <div class="form-group">
          <label>Password</label>
          <input type="password" id="signupPassword" class="form-input" required placeholder="Create a password">
        </div>

        <div style="margin-top:16px;">
          <button class="btn" type="submit">Sign Up</button>
        </div>

        <div style="margin:14px 0;text-align:center;color:#aaa">or</div>

        <button type="button" class="google-btn" id="googleSignUp"><i class="fa-brands fa-google"></i> Sign up with Google</button>

        <p style="margin-top:12px;color:#aaa;font-size:14px;text-align:center;">Already have an account? <a href="login.html" style="color:#f5c400; text-decoration:none;">Sign in</a></p>

        <div id="signupMessage" style="margin-top:12px;color:#22c55e; display:none;"></div>
        <div id="signupError" style="margin-top:12px;color:#ef4444; display:none;"></div>
      </form>
    </div>
  </div>

  <script>
    const API_BASE_URL = 'http://localhost:5000';

    document.getElementById('signupForm').addEventListener('submit', async function(e){
      e.preventDefault();
      const name = document.getElementById('signupName').value.trim();
      const email = document.getElementById('signupEmail').value.trim();
      const password = document.getElementById('signupPassword').value.trim();
      
      const msgDiv = document.getElementById('signupMessage');
      const errorDiv = document.getElementById('signupError');
      
      msgDiv.style.display = 'none';
      errorDiv.style.display = 'none';

      try {
        const response = await fetch(API_BASE_URL + '/register', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            name: name,
            email: email,
            password: password,
            role: 'clothes_admin'  // Default role for signup page
          })
        });

        const data = await response.json();

        if (!response.ok) {
          // Check if user already exists
          if (response.status >= 400 && (data.msg.includes('already') || data.msg.includes('exists') || data.msg.includes('duplicate'))) {
            errorDiv.textContent = 'You already signed up - now sign in';
          } else {
            errorDiv.textContent = data.msg || 'Sign up failed. Please try again.';
          }
          errorDiv.style.display = 'block';
          return;
        }

        // Success
        msgDiv.textContent = 'Welcome, ' + name + '! Account created successfully. Redirecting to login...';
        msgDiv.style.display = 'block';
        
        setTimeout(() => { 
          location.href = 'login.html'; 
        }, 1500);
      } catch (error) {
        console.error('Signup error:', error);
        errorDiv.textContent = 'Connection error - make sure backend is running on ' + API_BASE_URL;
        errorDiv.style.display = 'block';
      }
    });

    document.getElementById('googleSignUp').addEventListener('click', function(){
      // TODO: Implement real Google OAuth here
      const mock = {name: 'Google User', email: 'user@gmail.com'};
      localStorage.setItem('authToken', 'google-token');
      localStorage.setItem('userEmail', mock.email);
      const msg = document.getElementById('signupMessage');
      msg.textContent = 'Signed up as ' + mock.email;
      msg.style.display = 'block';
      setTimeout(() => { location.href = 'index.html'; }, 900);
    });
  </script>
<script src="js/script.js"></script>

  <footer class="footer">
    <div class="footer-links">
      <a href="index.html">Home</a>
      <a href="schools.html">Schools</a>
      <a href="billing.html">Billing</a>
      <a href="students.html">Students/Parents</a>
      <a href="profile.html">Profile</a>
      <a href="inventory.html">Inventory</a>
    </div>
    <div class="footer-copy">&copy; 2026 ClothsSales. All rights reserved.</div>
  </footer>
</body>
</html>